
Online功能:ECU测量标定、总线监测(在CANape中加载相应的总线数据库如DBC文件)、诊断功能(在CANape中加载标准的诊断数据库文件，如cdd文件，来实现诊断功能并执行相应的诊断服务等)、数据记录功能(开辟与第三层自动化系统的接口功能，比如可在台架软件中调用该接口，使用Ape)，刷写功能，CANape支持标准的CCP或者是XCP协议的刷写，以及加载标准的诊断Vflash工程，执行刷写功能;模型开发功能：该功能值CANape和simulink有相应的接口，比如在在线标定的过程中，可以通过添加simulink模型文件，并将simulink模型文件实时导入到CANape中，即可观测到模型中对应参数的值，实现标定辅助的功能，同时也可以将simulink的模型编译为Dll的算法，加载到CNAape中。利用此Dll算法来完成数据分析，或者是模型仿真等功能。

CANape还支持数字模拟等信号功能，CANape支持加载一些标准的数采模块，比如CSM等温度、压力等测量模块，CANape支持音视频以及图像处理的功能，Offline的功能包括三大部分，第一部分是离线数据的管理功能，这部分主要是针对标定数据而言，即CANape中自带一个VCD studio的离线参数标定管理工具，在该工具中可以完成对标定数据的查看，编辑，修改，复制，合并等功能

数据库的编辑功能：该功能主要是CANape自带a2l文件的编辑功能，ASCP2Edit或者ASCP2studio可以完成a2l文件的编辑、修改、合并等功能，CANape具备数据处理的功能，在CANape中可以完成离线数据的查看，报告打印等功能，并针对大数据的处理，提出了Data Mining的功能。



CANape工程主窗口分析：

Trace窗口可以监测总线的报文，

Model Explorer:实现对simulink模型的查看以及相应参数的监测

Graphic、Numerical窗口:实现对测量信号的观测，

Calibration:标定窗口，实现对标定窗口的修改，、

GPS音视频窗口可以完成相应的加持辅助功能，



测量标定系统规范的协会

ASAM组织(Association for Standardization of Automation and Measuring Systems)

该协会对测量标定系统进行了3层划分，并对每层制定了相应的规范，三层架构分别为ECU、测量标定系统(CANape软件)、上层自动化系统(Upperlevel automation system,比如台架软件)

第一层定义的是CCP和XCP协议，规范，CCP是一种CAN的标定协议，XCP是一种可以基于CAN、LIN、Flexray、以太网等诸多总线的标定协议，因此XCP协议是一种更为通用的标定协议。

第二层定义了A2L文件的规范，A2L文件中包含了测量量，标定量的地址，转换规则，单位名称等信息，扮演着翻译的角色，可以将报文中原始的hex值转换为对应的物理值，显示给用户

第三层定义了上次自动化系统与CANape工具的通信规范，所以如需要在其他软件中调用CANAPe，必须要遵守第三层软件规范，



接下来介绍如何搭建一个标定系统

首先，先考虑如何将ECU连接到CANape中，目前vector提供两种连接方式，第一种方式基于传统的总线接口卡，比如VN1610，1630等，通过连接ECU上标准的总线接口来，读取ECU中的数据，第二种是VX高速1000的解决方案，通过一个小的PUD来读取ECU调试接口端的数据，调试接口可以是NEXUS、JTAG、等接口。然后将数据传输给VX1000基础模块，该基础模块会将数据转化为XCP、以太网的形式传输给Ape，那么基于该方案测量的带宽，可以达到几兆，几十兆byte的带宽，甚至是



创建Ape工程：2中方式新建Ape Project

1、可以直接在开始菜单、运行Ape，然后通过Select Project该窗口新建一个工程，

2、或者进入Ape界面后，菜单栏选择New Project来创建一个新的工程

工程创建完以后需要将相应的数据库文件添加到APe中。APe中是通过添加Device的方式，来进行数据库的加载，比如需要添加A2L文件，那么可以新建一个CCp、XCP/VX1000的device。

菜单栏：Devices->New device,填写Device的名称和Comment，并选择协议类型

如果要实现对总线报文的监测，加载DBC文件。那么可以新建一个CAN的device，同理需要执行一些诊断的文件，加载Cdd文件，那么可以新建一个诊断的device，选择ECU->Diagnotic

Device在CANape中就是一个确定信号源的概念，

添加完A2L文件之后，需要将新建DEvices时用到的软件通道，与真实ECU连接物理通道匹配，才能完成真正意义上的连接，该匹配工作是在Vector Hardware Configration软件中完成的。

通道匹配完成之后可以点击Connect来连接ECU，连接完成之后，可以在Device窗口中看到相应的连接状态，当CAN1旁边的小框是黑色的时候，则表示ECU正确连接到了CANape中，与此同时，建议打开Write窗口，来查看工程中的相应信息，如果工程中有一些报错或者提示的话，可在write窗口中进行查看。同时，建议打开Trace窗口，在Trace窗口中可以去监测，CANape向下发送的一些报文信息，如要监测总线报文也可也在Trace窗口中实现。



Measurement configration ：CANape的测量功能，在CANape中，所有与测量相关的配置，可以点击F4，打开测量配置窗口，在测量配置窗口中，可以通过该窗口来添加需要的信号，添加完信号后，需要给信号配置一个测量模式，

在CANape中支持2种测量模式，第一种Polling测量模式，

Polling是简单的一问一答的形式，比如我要测量A和B，那么CANape会依次给ECU信号发送两条指令去请求信号A和信号B的值，从图形上可以看出，由于请求的报文是在2个时刻发出的，那么响应的报文也同时是在2个时刻回复的，所以信号A和信号B在时间上是不同步的，



如果需要进行同步测量，可以使用DAQ模式，该模式的测量原理，与polling完全不一样，DAQ的测量原理为，在测量开始时，CANape会将所以的测量列表下载至ECU中，然后ECU会根据测量配置列表，自动上传数据到ape中，测量列表中，会包括需要的测量的信号，以及对应测量信号的周期，因此在测量列表下载完成之后，ECU会自动根据配置好的信息来自动上传数据，因此在这种情况下，所以上传的数据在时间上是同步的，

配置完成之后，点击闪电按钮开始测量，无需再测量过程中继续观测测量信号的值或者是曲线，可以在Measurement list测量列表下，将测量信号拖拽至测量窗口，



Insert Measurement Signals in Display Windows:

Measurement Signals Display：CANape支持的测量窗口多种多样，通常用到的Graphic窗口，可以显示测量变量的曲线；Data窗口，可以在显示测量值的物理值的同时，显示备注、单位、地址等信息；Bar窗口可以用来对比两个测量变量的大小;Text窗口可以显示测量变量在一段时间内的值的遍历;Numeric窗口显示当前测量变量的值；Map窗口显示Map变量类型的值。同时在测量完成之后，cANape也支持将测量的数据保存成标准的测量文件，CANape中记录的测量为mdf格式，该文件可以在CANape中直接进行加载，目前mdf最新的格式为4.1版本，该版本支持压缩功能和总线记录的报文。如果需要配置记录模块，同样可以点击到测量配置窗口中完成，在添加完测量信号之后，CANape会创建一个默认的record，
